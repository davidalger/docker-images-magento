name: Docker Image CI
on:
  push:
    branches:
    - master

jobs:
  build:
    name: Magento ${{ matrix.MAJOR_VERSION }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        MAJOR_VERSION:
          - "2.2"
          - "2.3"
        include:
          - MAJOR_VERSION: "2.2"
            BUILD_VERSIONS: "2.2.8 2.2.9 2.2.10"
            PHP_VERSION: "7.1"

          - MAJOR_VERSION: "2.3"
            BUILD_VERSIONS: "2.3.0 2.3.1 2.3.2 2.3.3"
            PHP_VERSION: "7.2"

    steps:
    - uses: actions/checkout@v1
    - run: ./scripts/build.sh --push
      env:
        COMPOSER_AUTH: ${{ secrets.COMPOSER_AUTH }}
        BUILD_VERSIONS: ${{ matrix.BUILD_VERSIONS }}
        PHP_VERSION: ${{ matrix.PHP_VERSION }}
        DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
